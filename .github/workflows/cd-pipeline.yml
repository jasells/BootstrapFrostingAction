name: Event Based Deploy pipeline
on:
  repository_dispatch: #a repo-level scope for eventing (dispatching)
    types: [my-event]
  # workflow_dispatch:

  # # pull_request:
  # # push:
  # #   branches:
  # #     - main
  # #     - develop
  # #     - hotfix/*

  # workflow_run:
  #   branches: 
  #       - event-testing
  #   workflows:
  #       - Build
  #   types:
  #       - completed


env:
    BuildProject: "build/Build.csproj"
    BuildArgs: "--target=Github-Actions --testArg=testVal"


jobs:
  build:
    name: Deploy from event
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [windows-latest]
        #, ubuntu-latest, macos-latest]
    steps:
      # - name: Get the sources
      #   uses: actions/checkout@v3
      #   with:
      #     fetch-depth: 0

      - name: display Build vars
        shell: pwsh
        run: |
            Write-Output "workflow_run.event = " ${{ github.event.workflow_run.event }}
            Write-Output "workflow_run.branch = " ${{ github.event.workflow_run.head_branch }}
            Write-Output "build.env.BuildProject = " ${{ github.event.workflow_run.env.BuildProject }}
            Write-Output "github.event.client_payload = " ${{ github.event.client_payload.version }}
            Write-Output "github.event.runId = " ${{ github.event.client_payload.runId }}

      # - name: Install .NET SDK
      #   uses: actions/setup-dotnet@v4
      #   with:
      #     global-json-file: global.json

      # - name: Create Cake Boostrapper script
      #   run: |
      #     echo 'DotNetRun("${{ env.BuildProject }}", "${{ env.BuildArgs }}");' > build.cake

      # - name: Run Cake script
      #   uses: cake-build/cake-action@v2
      #   with:
      #     cake-version: 4.0.0
      #     target: "Github-Actions"
      #     # arguments: |
      #     #       name: value
      #     #       arg1: arg1val
